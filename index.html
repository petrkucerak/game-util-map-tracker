<!DOCTYPE html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MIKE tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
      body {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      // Vytvoření mapy
      var map = L.map("map").setView([50.0755, 14.4378], 13); // Centrováno na Prahu jako výchozí pozice

      // Přidání vrstev
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
      }).addTo(map);

      // Definování vlastní ikony pro marker
      var citizen = L.icon({
        iconUrl: "/citizen.png", // Zde nahraďte URL cestou k vaší ikoně
        iconSize: [60, 60], // Velikost ikony
        iconAnchor: [30, 30], // Bod na obrázku, kde se bude nacházet špička markeru
        popupAnchor: [0, -38], // Bod, odkud bude vycházet popup okno
      });

      // Marker pro aktuální polohu
      var currentLocationMarker = L.marker([50.0755, 14.4378], {
        icon: citizen,
      })
        .addTo(map)
        .bindPopup("101. Prapor teritoriální ochrany");

      // Funkce pro získání aktuální polohy a aktualizaci markeru
      function updateCurrentLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            currentLocationMarker.setLatLng([lat, lon]).update();
            // map.setView([lat, lon], 13); // Centrování mapy na novou polohu
          });
        }
      }

      // Aktualizace aktuální polohy každých 10 sekund
      setInterval(updateCurrentLocation, 10000);

      // Pole s definovanými polohami v čase
      var dynamicLocations = [
        { start_time: "2024-08-28 06:27:00", cords: [50.0855, 14.4378] },
        { start_time: "2024-08-28 06:35:00", cords: [50.0905, 14.448] },
        { start_time: "2024-08-28 06:40:00", cords: [50.0955, 14.459] },
        // Přidejte další body podle potřeby
      ];

      // Definování vlastní ikony pro marker
      var bandit = L.icon({
        iconUrl: "/bandit.png", // Zde nahraďte URL cestou k vaší ikoně
        iconSize: [60, 60], // Velikost ikony
        iconAnchor: [30, 30], // Bod na obrázku, kde se bude nacházet špička markeru
        popupAnchor: [0, -38], // Bod, odkud bude vycházet popup okno
      });

      var dynamicMarker = L.marker(dynamicLocations[0].cords, { icon: bandit })
        .addTo(map)
        .bindPopup("MIKE");

      function updateDynamicLocation() {
        var now = new Date();
        for (var i = 0; i < dynamicLocations.length; i++) {
          var startTime = new Date(dynamicLocations[i].start_time);
          if (
            now >= startTime &&
            (i == dynamicLocations.length - 1 ||
              now < new Date(dynamicLocations[i + 1].start_time))
          ) {
            dynamicMarker.setLatLng(dynamicLocations[i].cords).update();
            // map.setView(dynamicLocations[i].cords, 13);
            break;
          }
        }
      }

      // Aktualizace polohy dynamického bodu každých 5 sekund
      setInterval(updateDynamicLocation, 5000);

      // Zobrazení obou bodů ve výchozí pozici
      updateCurrentLocation();
      updateDynamicLocation();
    </script>
  </body>
</html>
